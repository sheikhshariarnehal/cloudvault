{
  "meta": {
    "project": "CloudVault",
    "date": "2026-02-19",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "CloudVault is a web-based personal cloud file storage product that uses Telegram (via a TDLib service) for file storage and Supabase for metadata, auth, and realtime sync. Users can upload, organize, preview, share, and download files through a Google Drive-like UI accessible from browsers (guest or registered).",
  "core_goals": [
    "Provide a fully functional web file manager (upload, download, organize, preview, share) accessible from any browser",
    "Support uploads up to 2 GB per file with streaming to avoid full-memory buffering",
    "Allow immediate use via guest sessions (90-day expiry) and enable guest-to-registered migration",
    "Use Telegram as a zero-cost storage backend while storing metadata and auth in Supabase",
    "Deliver realtime UI updates for files and folders using Supabase Realtime"
  ],
  "features": [
    {
      "name": "File Upload (Mobile & Desktop)",
      "description": "Allow users to upload single or multiple files from mobile file picker or desktop drag-and-drop and show per-file upload progress and final success/error states.",
      "user_flows": [
        "Navigate to /dashboard -> Tap the Upload button in the dashboard header -> Select file(s) from the mobile file picker dialog -> See upload progress in the fixed bottom-right progress panel -> See success checkmark and file appears in the dashboard",
        "Navigate to /dashboard -> Tap Create dropdown then Upload File menu item -> Select file(s) from the file picker -> See upload progress in the fixed bottom-right progress panel -> See success checkmark and file appears in the current folder",
        "Navigate to /dashboard -> Drag and drop files onto the dashboard area -> See upload progress items appear in the fixed bottom-right progress panel -> See success checkmark and files listed in the dashboard (desktop)",
        "Navigate to /dashboard -> Tap the Upload button in the dashboard header -> Select a file larger than 2 GB -> See an error message indicating the file exceeds the 2 GB limit and upload is rejected",
        "Navigate to /dashboard -> Tap the Upload button in the dashboard header -> Select file(s) -> Network interruption occurs during upload -> See upload error message and failed item state in the progress panel"
      ]
    },
    {
      "name": "Folder Upload (Desktop where supported)",
      "description": "Support uploading entire folders where browser supports webkitdirectory; entry point from the sidebar + New actions.",
      "user_flows": [
        "Navigate to /dashboard -> Tap + New button in sidebar then Folder upload -> Select folder from file picker (browser supports webkitdirectory) -> See per-file upload progress for folder contents -> See folder contents appear in current folder",
        "Navigate to /dashboard -> Tap + New button in sidebar then Folder upload -> Browser does not support folder selection on this device -> See message or UI state indicating folder upload is unavailable on this browser"
      ]
    },
    {
      "name": "File Management (Rename, Star, Trash, Restore, Delete)",
      "description": "Users can rename files, toggle starred state, move files to trash, restore from trash, and permanently delete files via context menus and trash view.",
      "user_flows": [
        "Navigate to /dashboard -> Right-click or long-press on a file to open context menu -> Click rename option -> Enter new name -> Click Save -> See file name updated in the dashboard",
        "Navigate to /dashboard -> Right-click or long-press on a file to open context menu -> Click star toggle -> See file display update to starred state",
        "Navigate to /dashboard -> Right-click or long-press on a file to open context menu -> Click move to trash -> See file removed from primary view and appear in /dashboard/trash",
        "Navigate to /dashboard/trash -> Click restore on a trashed file -> See file return to its original folder in /dashboard",
        "Navigate to /dashboard -> Right-click or long-press on a file to open context menu -> Click rename option -> Enter new name -> Network error occurs while saving -> See an error toast and file name remains unchanged",
        "Navigate to /dashboard/trash -> Click delete permanently on a trashed file -> API fails to delete due to remote service error -> See permanent delete error message and file remains in trash"
      ]
    },
    {
      "name": "Folder Management (Create, Rename, Navigate)",
      "description": "Create and organize nested folders, rename them, and navigate using breadcrumbs and the folder view.",
      "user_flows": [
        "Navigate to /dashboard -> Click Create dropdown then New Folder -> Enter folder name in modal dialog -> Click Create button -> See new folder appear in the current folder/list",
        "Navigate to /dashboard -> Click on a folder card -> See navigate to /dashboard/folder/[id] and view folder contents and breadcrumbs",
        "Navigate to /dashboard/folder/[id] -> Open folder context menu -> Click rename -> Enter new folder name -> Click Save -> See folder name updated in UI",
        "Navigate to /dashboard -> Click Create dropdown then New Folder -> Leave folder name blank -> Click Create -> See validation error preventing creation"
      ]
    },
    {
      "name": "File Preview (Modal and Full-Page)",
      "description": "Preview supported file types (image, video, audio, PDF) inline via a preview modal, and provide a full-page preview route for deep-linking and sharing.",
      "user_flows": [
        "Navigate to /dashboard -> Click on a file card to open preview modal -> View image, video, or PDF inline in the preview modal -> Click Download button in the modal -> Browser requests GET /file/[...params] and file download streams",
        "Navigate to /dashboard -> Click on a file card in the preview modal -> Click Navigate to full-page preview -> See /preview/[id] open with the full-page preview",
        "Navigate to /dashboard -> Click on a file with an unsupported preview mime type -> Preview modal shows fallback with a direct download button -> Click download to stream file via GET /file/[...params]",
        "Navigate to /dashboard -> Click on a file card to open preview modal -> Preview fails to load due to network error -> See an error state and a direct download link in the modal"
      ]
    },
    {
      "name": "File Sharing (Token-based Links)",
      "description": "Generate token-based public share links with optional expiry, password, and download limits; shared pages are viewable without login at /share/[token].",
      "user_flows": [
        "Navigate to /dashboard -> Right-click or long-press on a file to open context menu -> Click Share option -> Configure expiry or max downloads (optional) -> Click Create/Copy link -> See share link copied to clipboard",
        "Open a share link in a new browser -> Navigate to /share/[token] -> See public file metadata and preview (if allowed) -> Click Download to stream file",
        "Navigate to /dashboard -> Right-click or long-press on a file to open context menu -> Click Share option -> Attempt to create link but backend returns an error -> See an error toast and no link is created"
      ]
    },
    {
      "name": "Authentication (Login, Signup, OAuth, Guest)",
      "description": "Allow users to sign up / log in via email/password or OAuth, and use guest sessions for immediate access with a guest-to-registered migration flow.",
      "user_flows": [
        "Navigate to /auth/login -> Fill email field -> Fill password field -> Click Sign In button -> On success, redirect to /dashboard and see user files",
        "Navigate to /auth/signup -> Fill signup form -> Click Create account -> On success, redirect to /dashboard and see user files",
        "Navigate to /auth/login -> Click Google OAuth button -> Complete provider flow -> /auth/callback is invoked -> On success, redirect to /dashboard",
        "Open app as new visitor -> App auto-creates a guest session -> See /dashboard as guest with guest-scoped files -> Later click migrate account -> Navigate to /auth/migrate -> Complete signup -> Files are re-associated to new user_id",
        "Navigate to /auth/login -> Fill invalid credentials -> Click Sign In -> See authentication error message and remain on /auth/login"
      ]
    },
    {
      "name": "Search (Client-side filter)",
      "description": "Client-side search input filters files and folders in realtime within the dashboard without additional API calls.",
      "user_flows": [
        "Navigate to /dashboard -> Click search input in top bar -> Type search query -> See filtered file and folder results update as you type",
        "Navigate to /dashboard -> Click search input in top bar -> Type a query that matches no items -> See empty state indicating no results"
      ]
    },
    {
      "name": "Dashboard Views & Navigation",
      "description": "Provide multiple dashboard views (My Drive, Recent, Starred, Shared, Trash, Settings) and view toggles (grid/list) persisted in UI store.",
      "user_flows": [
        "Navigate to /dashboard -> See My Drive root-level files and folders with grid/list toggle -> Click toggle to change view -> See preference persisted",
        "Navigate to /dashboard/recent -> See files sorted by updated_at desc",
        "Navigate to /dashboard/starred -> See all starred files",
        "Navigate to /dashboard/shared -> See files with active share links",
        "Navigate to /dashboard/trash -> See trashed files and perform restore or permanent delete actions",
        "Navigate to /dashboard/settings -> See user profile and preferences -> Change preference -> Click Save -> See confirmation",
        "Attempt to access /dashboard while not authenticated and middleware requires auth -> Be redirected to /auth/login and prompted to sign in or continue as guest"
      ]
    },
    {
      "name": "Storage Meter & Quota",
      "description": "Show visual storage usage in the sidebar and enforce default storage quotas for registered users.",
      "user_flows": [
        "Navigate to /dashboard -> See storage usage meter in the sidebar showing storage_used_bytes vs storage_limit_bytes",
        "Upload files until storage limit exceeded -> See an error preventing uploads that would exceed the user's quota"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js 16 (App Router)",
      "React 19",
      "Tailwind CSS 4",
      "Radix UI (shadcn/ui components)",
      "Zustand (state management)",
      "Supabase (auth + database)",
      "react-dropzone (file upload)",
      "lucide-react (icons)"
    ],
    "routes": [
      {
        "path": "/auth/login",
        "file": "src/app/auth/login/page.tsx",
        "auth_required": false,
        "description": "User login page with email/password, magic link, or Google OAuth"
      },
      {
        "path": "/auth/signup",
        "file": "src/app/auth/signup/page.tsx",
        "auth_required": false,
        "description": "User signup page with email/password"
      },
      {
        "path": "/auth/callback",
        "file": "src/app/auth/callback/route.ts",
        "auth_required": false,
        "description": "OAuth callback handler"
      },
      {
        "path": "/auth/migrate",
        "file": "src/app/auth/migrate/page.tsx",
        "auth_required": false,
        "description": "Guest-to-user migration page"
      },
      {
        "path": "/dashboard",
        "file": "src/app/dashboard/page.tsx",
        "auth_required": false,
        "description": "Main dashboard showing files, folders, upload buttons. Works for both authenticated users and guests."
      },
      {
        "path": "/dashboard/folder/[id]",
        "file": "src/app/dashboard/folder/[id]/page.tsx",
        "auth_required": false,
        "description": "Folder contents view with breadcrumbs"
      },
      {
        "path": "/dashboard/recent",
        "file": "src/app/dashboard/recent/page.tsx",
        "auth_required": false,
        "description": "Recently accessed files"
      },
      {
        "path": "/dashboard/starred",
        "file": "src/app/dashboard/starred/page.tsx",
        "auth_required": false,
        "description": "Starred/favorited files"
      },
      {
        "path": "/dashboard/shared",
        "file": "src/app/dashboard/shared/page.tsx",
        "auth_required": false,
        "description": "Shared files listing"
      },
      {
        "path": "/dashboard/trash",
        "file": "src/app/dashboard/trash/page.tsx",
        "auth_required": false,
        "description": "Trashed files with restore/permanent delete"
      },
      {
        "path": "/dashboard/settings",
        "file": "src/app/dashboard/settings/page.tsx",
        "auth_required": false,
        "description": "User settings page"
      },
      {
        "path": "/share/[token]",
        "file": "src/app/share/[token]/page.tsx",
        "auth_required": false,
        "description": "Public shared file view"
      },
      {
        "path": "/preview/[id]",
        "file": "src/app/preview/[id]/page.tsx",
        "auth_required": false,
        "description": "Full-page file preview"
      },
      {
        "path": "/file/[...params]",
        "file": "src/app/file/[...params]/route.ts",
        "auth_required": false,
        "description": "File download/stream endpoint"
      }
    ],
    "features": [
      {
        "name": "File Upload (Mobile)",
        "description": "Upload files from mobile devices via file picker or drag-and-drop. On mobile, the primary interaction is tapping an Upload button which triggers a hidden file input via react-dropzone's open() method stored in UI store.",
        "files": [
          "src/components/upload/upload-zone.tsx",
          "src/components/upload/upload-progress.tsx",
          "src/app/api/upload/route.ts",
          "src/store/ui-store.ts",
          "src/store/files-store.ts",
          "src/types/file.types.ts",
          "src/app/dashboard/page.tsx",
          "src/app/dashboard/layout.tsx",
          "src/components/sidebar/sidebar.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Tap the Upload button in the dashboard header",
          "Tap Create dropdown then Upload File menu item",
          "Tap + New button in sidebar then File upload menu item",
          "Select file(s) from the mobile file picker dialog",
          "See upload progress in the fixed bottom-right progress panel",
          "See success checkmark or error message after upload",
          "Drag and drop files onto the dashboard area (desktop only)"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/upload"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Folder Upload (Mobile)",
        "description": "Upload entire folders. Uses webkitdirectory attribute which is not supported on iOS Safari and many Android browsers.",
        "files": [
          "src/components/sidebar/sidebar.tsx",
          "src/components/upload/upload-zone.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Tap + New in sidebar then Folder upload",
          "Select folder from file picker (if supported)"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/upload"
          }
        ],
        "auth_required": false
      },
      {
        "name": "File Management",
        "description": "Rename, star, trash, restore, and permanently delete files",
        "files": [
          "src/components/context-menu/file-context-menu.tsx",
          "src/store/files-store.ts",
          "src/app/api/files/route.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Right-click or long-press on a file to open context menu",
          "Click rename option and enter new name",
          "Click star/unstar toggle",
          "Click move to trash",
          "In trash view, click restore or delete permanently"
        ],
        "api_calls": [
          {
            "method": "PATCH",
            "endpoint": "/api/files"
          },
          {
            "method": "DELETE",
            "endpoint": "/api/files"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Folder Management",
        "description": "Create, rename, and navigate folders",
        "files": [
          "src/components/modals/new-folder-modal.tsx",
          "src/app/api/folders/route.ts",
          "src/app/dashboard/folder/[id]/page.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Click Create dropdown then New Folder",
          "Enter folder name in modal dialog",
          "Click Create button to submit",
          "Navigate into folders by clicking them"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/folders"
          },
          {
            "method": "PATCH",
            "endpoint": "/api/folders"
          }
        ],
        "auth_required": false
      },
      {
        "name": "File Preview",
        "description": "Preview files in a modal or full-page view",
        "files": [
          "src/components/preview/preview-modal.tsx",
          "src/app/preview/[id]/page.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Click on a file card to open preview modal",
          "View image, video, audio, or PDF inline",
          "Download file from preview",
          "Navigate to full-page preview"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/download"
          }
        ],
        "auth_required": false
      },
      {
        "name": "File Sharing",
        "description": "Generate shareable public links for files",
        "files": [
          "src/components/modals/share-modal.tsx",
          "src/app/api/share/route.ts",
          "src/app/share/[token]/page.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Open context menu on a file",
          "Click Share option",
          "Copy generated share link",
          "Set expiry or download limits"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/share"
          },
          {
            "method": "GET",
            "endpoint": "/api/share/[token]"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Authentication",
        "description": "User login, signup, and guest mode",
        "files": [
          "src/app/auth/login/page.tsx",
          "src/app/auth/signup/page.tsx",
          "src/app/providers/auth-provider.tsx",
          "src/middleware.ts"
        ],
        "entry_route": "/auth/login",
        "user_interactions": [
          "Fill email and password fields",
          "Click Sign In button",
          "Click Sign Up link to go to signup",
          "Click Google OAuth button",
          "Continue as guest (auto-assigned session)"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/auth/v1/token (Supabase Auth)"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Search",
        "description": "Client-side search/filter for files and folders",
        "files": [
          "src/components/top-bar/top-bar.tsx",
          "src/store/files-store.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Click search input in top bar",
          "Type search query",
          "See filtered file and folder results"
        ],
        "api_calls": [],
        "auth_required": false
      }
    ],
    "known_limitations": [
      {
        "issue": "Folder upload uses webkitdirectory attribute which is unsupported on iOS Safari and most Android browsers",
        "location": "src/components/sidebar/sidebar.tsx",
        "impact": "Folder upload silently fails or shows no folder picker on mobile devices"
      },
      {
        "issue": "Upload progress panel is fixed at w-80 (320px) with no responsive sizing",
        "location": "src/components/upload/upload-progress.tsx",
        "impact": "May overflow or be clipped on small mobile screens (< 360px width)"
      },
      {
        "issue": "Upload progress panel does not account for safe-area-inset-bottom",
        "location": "src/components/upload/upload-progress.tsx",
        "impact": "Panel may be hidden behind iOS home indicator or Android navigation bar"
      },
      {
        "issue": "No camera capture option for mobile photo uploads",
        "location": "src/components/upload/upload-zone.tsx",
        "impact": "Users cannot directly take photos to upload, must use file picker"
      },
      {
        "issue": "Empty state text references drag and drop which is desktop-only",
        "location": "src/app/dashboard/page.tsx",
        "impact": "Confusing UX on mobile where drag-and-drop is not available"
      },
      {
        "issue": "No chunked upload for large files on mobile",
        "location": "src/components/upload/upload-zone.tsx",
        "impact": "Large file uploads may crash mobile browser tabs due to memory constraints"
      },
      {
        "issue": "react-dropzone open() may not trigger file picker on some mobile browsers without direct user gesture",
        "location": "src/components/upload/upload-zone.tsx",
        "impact": "File picker may fail to open on mobile when triggered through indirect event chain (store â†’ callback)"
      }
    ]
  }
}
